{"version":3,"sources":["app.es6"],"names":[],"mappings":";;AAAA,IAAI,cAAc,QAAQ,aAAR,CAAlB;AACA,IAAI,UAAU,QAAQ,SAAR,CAAd;AACA,IAAI,OAAO,QAAQ,MAAR,CAAX;AACA,IAAI,UAAU,QAAQ,eAAR,CAAd;AACA,IAAI,SAAS,QAAQ,QAAR,CAAb;AACA,IAAI,eAAe,QAAQ,eAAR,CAAnB;AACA,IAAI,aAAa,QAAQ,aAAR,CAAjB;;AAEA,IAAI,UAAU,QAAQ,iBAAR,CAAd;AACA,IAAI,mBAAmB,QAAQ,mBAAR,CAAvB;AACA,IAAI,kBAAkB,QAAQ,kBAAR,CAAtB;AACA,IAAI,aAAa,QAAQ,cAAR,CAAjB;AACA,IAAI,UAAU,QAAQ,WAAR,CAAd;AACA,IAAI,WAAW,QAAQ,UAAR,CAAf;AACA,IAAI,gBAAgB,QAAQ,gBAAR,EAA0B,QAA9C;AACA,IAAI,QAAQ,QAAQ,eAAR,CAAZ;AACA,IAAI,aAAa,QAAQ,YAAR,CAAjB;AACA,IAAI,YAAY,QAAQ,YAAR,CAAhB;AACA,IAAI,SAAS,QAAQ,UAAR,CAAb;AACA,IAAI,QAAQ,QAAQ,OAAR,CAAZ;;AAEA;AACA,QAAQ,gBAAR;;AAEA,IAAI,QAAQ,QAAQ,gBAAR,CAAZ;AACA,IAAI,QAAQ,QAAQ,gBAAR,CAAZ;AACA,IAAI,eAAe,QAAQ,6BAAR,CAAnB;AACA,IAAI,aAAa,QAAQ,2BAAR,CAAjB;AACA,IAAI,SAAS,QAAQ,uBAAR,CAAb;AACA,IAAI,eAAe,QAAQ,6BAAR,CAAnB;AACA,IAAI,eAAe,QAAQ,8BAAR,CAAnB;AACA,IAAI,MAAM,QAAQ,oBAAR,CAAV;;AAEA,IAAI,MAAM,SAAV;;AAEA;AACA,IAAI,GAAJ,CAAQ,OAAR,EAAiB,KAAK,IAAL,CAAU,SAAV,EAAqB,OAArB,CAAjB;AACA,IAAI,GAAJ,CAAQ,aAAR,EAAuB,MAAvB;;AAEA;AACA;;AAEA;AACA,IAAI,GAAJ,CAAQ,aAAR;;AAEA,IAAI,GAAJ,CAAQ,OAAO,KAAP,CAAR;AACA,IAAI,GAAJ,CAAQ,WAAW,IAAX,EAAR;AACA,IAAI,GAAJ,CAAQ,WAAW,UAAX,CAAsB,EAAE,UAAU,KAAZ,EAAtB,CAAR;AACA,IAAI,GAAJ,CAAQ,QAAQ;AACZ,YAAQ,aADI;AAEZ,uBAAmB,IAFP;AAGZ,YAAQ;AAHI,CAAR,CAAR;AAKA,IAAI,GAAJ,CAAQ,OAAR;AACA,IAAI,GAAJ,CAAQ,SAAS,UAAT,EAAR;AACA,IAAI,GAAJ,CAAQ,SAAS,OAAT,EAAR;AACA,IAAI,GAAJ,CAAQ,iBAAiB;AACrB,oBAAgB,wBAAS,KAAT,EAAgB,GAAhB,EAAqB,KAArB,EAA4B;AACxC,YAAI,YAAY,MAAM,KAAN,CAAY,GAAZ,CAAhB;AAAA,YACI,OAAO,UAAU,KAAV,EADX;AAAA,YAEI,YAAY,IAFhB;;AAIA,eAAM,UAAU,MAAhB,EAAwB;AACpB,yBAAa,MAAM,UAAU,KAAV,EAAN,GAA0B,GAAvC;AACH;AACD,eAAO;AACH,mBAAQ,SADL;AAEH,iBAAQ,GAFL;AAGH,mBAAQ;AAHL,SAAP;AAKH;AAdoB,CAAjB,CAAR;AAgBA,IAAI,GAAJ,CAAQ,cAAR;AACA,IAAI,GAAJ,CAAQ,QAAQ,MAAR,CAAe,KAAK,IAAL,CAAU,SAAV,EAAqB,QAArB,CAAf,CAAR;AACA,IAAI,GAAJ,CAAQ,mBAAR,EAA6B,QAAQ,MAAR,CAAe,YAAY,mBAA3B,CAA7B;;AAEA;AACA,WAAW,OAAX,CAAmB,UAAS,GAAT,EAAc;AAC7B,QAAI,GAAJ,EAAS;AACL,gBAAQ,GAAR,CAAY,EAAE,MAAM,KAAR,EAAe,SAAS,4BAAxB,EAAZ;AACA,gBAAQ,IAAR,CAAa,CAAb;AACH,KAHD,MAIK;AACD,gBAAQ,GAAR,CAAY,EAAE,MAAM,KAAR,EAAe,SAAS,iCAAxB,EAAZ;AACH;AACJ,CARD;;AAUA,SAAS,aAAT,CAAuB,UAAS,IAAT,EAAe,IAAf,EAAqB;AACxC,SAAK,IAAL,EAAW,KAAK,QAAhB;AACH,CAFD;;AAIA,SAAS,eAAT,CAAyB,UAAS,QAAT,EAAmB,IAAnB,EAAyB;AAC9C,eAAW,GAAX,GAAiB,KAAjB,CAAuB,wCAAvB,EAAiE,CAAC,QAAD,CAAjE,EAA6E,UAAS,GAAT,EAAc,IAAd,EAAoB;AAC7F,aAAK,GAAL,EAAU,KAAK,CAAL,CAAV;AACH,KAFD;AAGH,CAJD;;AAMA,SAAS,GAAT,CAAa,IAAI,aAAJ,CACT,UAAS,QAAT,EAAmB,QAAnB,EAA6B,IAA7B,EAAmC;AAC/B,eAAW,GAAX,GAAiB,KAAjB,CAAuB,wCAAvB,EAAiE,CAAC,SAAS,WAAT,EAAD,CAAjE,EAA2F,UAAS,GAAT,EAAc,IAAd,EAAoB;AAC3G,YAAG,GAAH,EAAQ;AACJ,kBAAM,KAAK,GAAL,CAAN;AACH;AACD,YAAG,CAAC,KAAK,CAAL,CAAJ,EAAa;AACT,mBAAO,KAAK,IAAL,EAAW,KAAX,EAAkB,EAAE,SAAS,oBAAX,EAAlB,CAAP;AACH;AACD,YAAG,CAAC,OAAO,WAAP,CAAmB,QAAnB,EAA6B,KAAK,CAAL,EAAQ,QAArC,CAAJ,EAAoD;AAChD,mBAAO,KAAK,IAAL,EAAW,KAAX,EAAkB,EAAE,SAAS,oBAAX,EAAlB,CAAP;AACH;;AAED,eAAO,KAAK,IAAL,EAAW,KAAK,CAAL,CAAX,CAAP;AACH,KAZD;AAaH,CAfQ,CAAb;;AAkBA,IAAI,GAAJ,CAAQ,UAAU,GAAV,EAAe,GAAf,EAAoB,IAApB,EAA0B;AAC9B,QAAI,MAAJ,CAAW,QAAX,GAAsB,gBAAgB,GAAhB,EAAqB,GAArB,CAAtB;AACA;AACH,CAHD;;AAKA,IAAI,GAAJ,CAAQ,GAAR,EAAa,UAAS,GAAT,EAAc,GAAd,EAAmB,IAAnB,EAAyB;AAClC,QAAI,MAAJ,CAAW,IAAX,GAAkB,IAAI,IAAJ,IAAY,IAA9B;AACA;AACH,CAHD;;AAKA,IAAI,IAAJ,CAAS,GAAT,EAAc,UAAS,GAAT,EAAc,GAAd,EAAmB,IAAnB,EAAyB;AACnC,QAAI,MAAJ,CAAW,IAAX,GAAkB,IAAI,IAAJ,IAAY,IAA9B;AACA;AACH,CAHD;;AAKA,IAAI,GAAJ,CAAQ,GAAR,EAAa,KAAb;AACA,IAAI,GAAJ,CAAQ,QAAR,EAAkB,KAAlB;AACA,IAAI,GAAJ,CAAQ,qBAAR,EAA+B,YAA/B;AACA,IAAI,GAAJ,CAAQ,mBAAR,EAA6B,UAA7B;AACA,IAAI,GAAJ,CAAQ,eAAR,EAAyB,MAAzB;AACA,IAAI,GAAJ,CAAQ,qBAAR,EAA+B,YAA/B;AACA,IAAI,GAAJ,CAAQ,sBAAR,EAAgC,YAAhC;AACA,IAAI,GAAJ,CAAQ,YAAR,EAAsB,GAAtB;;AAIA;AACA,IAAI,GAAJ,CAAQ,UAAS,GAAT,EAAc,GAAd,EAAmB,IAAnB,EAAyB;AAC7B,QAAI,MAAM,IAAI,KAAJ,CAAU,WAAV,CAAV;AACA,QAAI,MAAJ,GAAa,GAAb;AACA,SAAK,GAAL;AACH,CAJD;;AAMA;;AAEA;AACA;AACA,IAAG,QAAQ,GAAR,CAAY,QAAZ,KAAyB,aAA5B,EAA2C;AACvC,QAAI,GAAJ,CAAQ,UAAS,GAAT,EAAc,GAAd,EAAmB,GAAnB,EAAwB,IAAxB,EAA8B;AAClC,YAAI,MAAJ,CAAW,IAAI,MAAJ,IAAc,GAAzB;AACA,YAAI,MAAJ,CAAW,OAAX,EAAoB;AAChB,qBAAS,IAAI,OADG;AAEhB,mBAAO;AAFS,SAApB;AAIH,KAND;AAOH,CARD,MASK;AACD;AACA;AACA,QAAI,GAAJ,CAAQ,UAAS,GAAT,EAAc,GAAd,EAAmB,GAAnB,EAAwB,IAAxB,EAA8B;AAClC,YAAG,IAAI,IAAP,EAAa;AACT,mBAAO,IAAI,QAAJ,CAAa,SAAb,CAAP;AACH,SAFD,MAGK;AACD,mBAAO,IAAI,QAAJ,CAAa,GAAb,CAAP;AACH;;AAED;;;;;;;AAOH,KAfD;AAgBH;;AAED,OAAO,OAAP,GAAiB,GAAjB","file":"app.js","sourcesContent":["var compression = require('compression');\nvar express = require('express');\nvar path = require('path');\nvar favicon = require('serve-favicon');\nvar logger = require('morgan');\nvar cookieParser = require('cookie-parser');\nvar bodyParser = require('body-parser');\n\nvar session = require('express-session');\nvar expressValidator = require('express-validator');\nvar expressMessages = require('express-messages');\nvar connection = require('./connection');\nvar utility = require(\"./utility\");\nvar passport = require('passport');\nvar LocalStrategy = require('passport-local').Strategy;\nvar flash = require('connect-flash');\nvar nodemailer = require('nodemailer');\nvar randtoken = require('rand-token');\nvar bcrypt = require('bcryptjs');\nvar async = require('async');\n\n// babel polyfill\nrequire(\"babel-polyfill\");\n\nvar index = require('./routes/index');\nvar users = require('./routes/users');\nvar observations = require('./routes/users/observations');\nvar behaviours = require('./routes/users/behaviours');\nvar binder = require('./routes/users/binder');\nvar transactions = require('./routes/users/transactions');\nvar sellingHours = require('./routes/users/selling-hours');\nvar wmp = require('./routes/users/wmp');\n\nvar app = express();\n\n// view engine setup\napp.set('views', path.join(__dirname, 'views'));\napp.set('view engine', 'jade');\n\n// uncomment after placing your favicon in /public\n//app.use(favicon(path.join(__dirname, 'public', 'favicon.ico')));\n\n// set application to use gzip compression\napp.use(compression());\n\napp.use(logger('dev'));\napp.use(bodyParser.json());\napp.use(bodyParser.urlencoded({ extended: false }));\napp.use(session({\n    secret: 'telus_build',\n    saveUninitialized: true,\n    resave: true\n}));\napp.use(flash());\napp.use(passport.initialize());\napp.use(passport.session());\napp.use(expressValidator({\n    errorFormatter: function(param, msg, value) {\n        var namespace = param.split('.'),\n            root = namespace.shift(),\n            formParam = root;\n\n        while(namespace.length) {\n            formParam += '[' + namespace.shift() + ']';\n        }\n        return {\n            param : formParam,\n            msg   : msg,\n            value : value\n        };\n    }\n}));\napp.use(cookieParser());\napp.use(express.static(path.join(__dirname, 'public')));\napp.use('/bower_components', express.static(__dirname + '/bower_components'));\n\n// use mysql connection\nconnection.connect(function(err) {\n    if (err) {\n        utility.log({ type: 'log', message: 'Unable to connect to MySQL' });\n        process.exit(1);\n    }\n    else {\n        utility.log({ type: 'log', message: 'Database connection established' });\n    }\n});\n\npassport.serializeUser(function(user, done) {\n    done(null, user.t_number);\n});\n\npassport.deserializeUser(function(t_number, done) {\n    connection.get().query('SELECT * FROM users WHERE t_number = ?', [t_number], function(err, rows) {\n        done(err, rows[0]);\n    });\n});\n\npassport.use(new LocalStrategy(\n    function(username, password, done) {\n        connection.get().query('SELECT * FROM users WHERE username = ?', [username.toLowerCase()], function(err, rows) {\n            if(err) {\n                throw done(err);\n            }\n            if(!rows[0]) {\n                return done(null, false, { message: 'Incorrect username' });\n            }\n            if(!bcrypt.compareSync(password, rows[0].password)) {\n                return done(null, false, { message: 'Incorrect password' });\n            }\n\n            return done(null, rows[0]);\n        });\n    }\n));\n\napp.use(function (req, res, next) {\n    res.locals.messages = expressMessages(req, res);\n    next();\n});\n\napp.get('*', function(req, res, next) {\n    res.locals.user = req.user || null;\n    next();\n});\n\napp.post('*', function(req, res, next) {\n    res.locals.user = req.user || null;\n    next();\n});\n\napp.use('/', index);\napp.use('/users', users);\napp.use('/users/observations', observations);\napp.use('/users/behaviours', behaviours);\napp.use('/users/binder', binder);\napp.use('/users/transactions', transactions);\napp.use('/users/selling-hours', sellingHours);\napp.use('/users/wmp', wmp);\n\n\n\n// catch 404 and forward to error handler\napp.use(function(req, res, next) {\n    var err = new Error('Not Found');\n    err.status = 404;\n    next(err);\n});\n\n// error handlers\n\n// development error handler\n// will print stacktrace\nif(process.env.NODE_ENV === 'development') {\n    app.use(function(err, req, res, next) {\n        res.status(err.status || 500);\n        res.render('error', {\n            message: err.message,\n            error: err\n        });\n    });\n}\nelse {\n    // production error handler\n    // no stack traces leaked to user\n    app.use(function(err, req, res, next) {\n        if(req.user) {\n            return res.redirect('/users/');\n        }\n        else {\n            return res.redirect('/');\n        }\n\n        /*\n         res.status(err.status || 500);\n         res.render('error', {\n         message: err.message,\n         error: {}\n         });\n         */\n    });\n}\n\nmodule.exports = app;"]}
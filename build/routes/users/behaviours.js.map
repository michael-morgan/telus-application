{"version":3,"sources":["behaviours.es6"],"names":[],"mappings":"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","file":"behaviours.js","sourcesContent":["/**\r\n * Created by Jacob on 2016-05-29.\r\n */\r\nvar express = require('express');\r\nvar connection = require('../../connection');\r\nvar passport = require('passport');\r\nvar async = require('async');var async = require('async');\r\nimport * as utility from \"../../utility\";\r\n\r\nvar behaviourModel = require('../../models/observation');\r\nvar returnObj = {};\r\nvar router = express.Router();\r\n\r\n// Get for behaviours and show them for each skill\r\nrouter.get('/', ensureAuthenticated, function (req, res, next) {\r\n    returnObj['message'] = undefined;\r\n    //Ensure user is logged in\r\n    if (req.user.privileged <= 2) { return res.redirect('/users/'); }\r\n\r\n    if (!req.body) { return res.sendStatus(400); }\r\n\r\n    returnObj['title'] = 'Behaviours';\r\n\r\n    //Display success message on adding,editing or remove a behaviour/skill\r\n    if(req.session.success)\r\n    {\r\n        res.locals.success_messages = req.flash('success_messages');\r\n        req.session.success = false;\r\n    }\r\n\r\n    //Connection to get all the skills\r\n    connection.get().query('SELECT skill_id,skill_title FROM skills', function (err, skillResults) {\r\n        //If an error is thrown\r\n        if (err) {\r\n            returnObj['message'] = 'Our database servers maybe down. Please try again.';\r\n            //Render the page wth error messages\r\n            return res.render('behaviours/behaviours', returnObj);\r\n        }\r\n\r\n        //Connection to get all behaviours\r\n        connection.get().query('SELECT skill_id,behaviour_id,behaviour_desc FROM behaviours', function (err, behaviourResults) {\r\n            //If an error is thrown\r\n            if (err) {\r\n                returnObj['message'] = 'Our database servers maybe down. Please try again.';\r\n                //Render the page wth error messages\r\n                return res.render('behaviours/behaviours', returnObj);\r\n            }\r\n\r\n            returnObj['skills'] = skillResults;\r\n            returnObj['behaviours'] = behaviourResults;\r\n            //Render the behaviours page with a list of behaviours and skills\r\n            res.render('behaviours/behaviours', returnObj);\r\n        });\r\n    });\r\n});\r\n//Display the add behaviour page, you can edit and remove behaviours here as well\r\nrouter.get('/add-behaviour', ensureAuthenticated, function (req, res, next) {\r\n    if (req.user.privileged <= 2) {\r\n        return res.redirect('/users/');\r\n    }\r\n\r\n    if (!req.body) {\r\n        return res.sendStatus(400);\r\n    }\r\n\r\n    var returnObj = {\r\n        title :'Add Behaviour'\r\n    };\r\n\r\n    returnObj['message'] = undefined;\r\n\r\n    //Connection to get all skills\r\n    connection.get().query('SELECT skill_id,skill_title FROM skills', function (err, skillResults) {\r\n        //If an error is thrown\r\n        if (err) {\r\n            returnObj['message'] = 'Our database servers maybe down. Please try again.';\r\n            //Render the page wth error messages\r\n            return res.render('behaviours/add-behaviour', returnObj);\r\n        }\r\n        //We are not removing a skill in this case\r\n        returnObj['canRemove'] = undefined;\r\n        //Render the add-behaviour page with an interface to perform CRUD\r\n        return res.render('behaviours/add-behaviour', returnObj);\r\n    });\r\n});\r\n\r\n// When the add-behaviour page is loaded, and there is a skill id in the url.\r\nrouter.get('/add-behaviour/:skill', ensureAuthenticated, function (req, res, next) {\r\n    if (req.user.privileged <= 2) {\r\n        return res.redirect('/users/');\r\n    }\r\n\r\n    if (!req.body) { return res.sendStatus(400); }\r\n    returnObj['message'] = undefined;\r\n    returnObj['title'] ='Edit Skills/Behaviours';\r\n    //Connection to get all skills\r\n    connection.get().query('SELECT skill_id,skill_title FROM skills', function (err, skillResults) {\r\n        //If an error is thrown\r\n        if (err) {\r\n            returnObj['message'] = 'Our database servers maybe down. Please try again.';\r\n            //Render the page wth error messages\r\n            return res.render('behaviours/add-behaviour', returnObj);\r\n        }\r\n        else {\r\n            //Get the skill id we are working with by using the skill parameter in the URL\r\n            connection.get().query('SELECT skills.skill_id,skills.skill_title,behaviour_id,behaviours.behaviour_desc FROM skills INNER JOIN behaviours ON skills.skill_id = behaviours.skill_id ' +\r\n                'WHERE skills.skill_id = ?', req.params.skill, function (err, behaviourResults) {\r\n                //If an error is thrown\r\n                if (err) {\r\n                    returnObj['message'] = 'Our database servers maybe down. Please try again.';\r\n                    //Render the page wth error messages\r\n                    return res.render('behaviours/add-behaviour', returnObj);\r\n                }\r\n                //No errors render the add-behaviour page\r\n                else {\r\n                    //We are not removing a skill in this case\r\n                    returnObj['canRemove'] = undefined;\r\n                    returnObj['selectedskill'] = behaviourResults;\r\n                    return res.render('behaviours/add-behaviour', returnObj);\r\n                }\r\n            });\r\n        }\r\n    });\r\n});\r\n\r\n// When the add-behaviour page is loaded, and there is a skill id in the url and the user clicked Remove skill\r\nrouter.get('/add-behaviour/:skill/:canRemove', ensureAuthenticated, function (req, res, next) {\r\n    if (req.user.privileged <= 2) {\r\n        return res.redirect('/users/');\r\n    }\r\n\r\n    if (!req.body) { return res.sendStatus(400); }\r\n    returnObj['message'] = undefined;\r\n    returnObj['title'] ='Edit Skills/Behaviours';\r\n    //Connection to get all skills\r\n    connection.get().query('SELECT skill_id,skill_title FROM skills', function (err, skillResults) {\r\n        //If an error is thrown\r\n        if (err) {\r\n            returnObj['message'] = 'Our database servers maybe down. Please try again.';\r\n            //Render the page wth error messages\r\n            return res.render('behaviours/add-behaviour', returnObj);\r\n        }\r\n        else {\r\n            //Get the skill we are working with\r\n            connection.get().query('SELECT skills.skill_id,skills.skill_title,behaviour_id,behaviours.behaviour_desc FROM skills INNER JOIN behaviours ON skills.skill_id = behaviours.skill_id ' +\r\n                'WHERE skills.skill_id = ?', req.params.skill, function (err, behaviourResults) {\r\n                //If an error is thrown\r\n                if (err) {\r\n                    returnObj['message'] = 'Our database servers maybe down. Please try again.';\r\n                    //Render the page wth error messages\r\n                    return res.render('behaviours/add-behaviour', returnObj);\r\n                }\r\n                //If all is well, render the add behaviour page and pass a remove parameter to automatically open the delete interface\r\n                else {\r\n                    returnObj['selectedskill'] = behaviourResults;\r\n                    returnObj['canRemove'] = req.params.canRemove;\r\n                    return res.render('behaviours/add-behaviour', returnObj);\r\n                }\r\n            });\r\n        }\r\n    });\r\n});\r\n\r\n// When we submit the add behaviour page with a skill and a remove parameter\r\nrouter.post('/add-behaviour/:skill/:canRemove', ensureAuthenticated, function (req, res, next) {\r\n    if (!req.body) { return res.sendStatus(400); }\r\n    //Set the save data to null first so its not passed if the form submission was successful\r\n    returnObj['savedBehaviours'] = undefined;\r\n    returnObj['skillTitle'] = undefined;\r\n    //Store variables from the submitted form\r\n    var behaviours = req.body;\r\n    var skillTitle = req.body.skillTitleBox;\r\n    var behaviourDesc = '';\r\n    var num = '';\r\n    returnObj['title'] ='Edit Skills/Behaviours';\r\n    var behaviourAdded = false;\r\n    var behaviourDeleted = false;\r\n    var skillDeleted = false;\r\n    //Execute these functions in series, that is 1 after the other\r\n    async.series([\r\n        filterPostData,\r\n        deleteSkills,\r\n        deleteBehaviours,\r\n        updateSkill,\r\n        updateBehaviour,\r\n        redirectUser\r\n    ], function(err, results){\r\n    });\r\n    //Filter submitted data\r\n    function filterPostData(fnCallback) {\r\n        async.eachSeries(Object.keys(behaviours), function (aBehaviour, callback) {\r\n            if (aBehaviour.indexOf('skillid') == -1 && aBehaviour.indexOf('behaviourid') == -1 && aBehaviour.indexOf('deletebehaviourid') == -1 && aBehaviour.indexOf('deleteskillid') == -1) {\r\n                delete behaviours[aBehaviour];\r\n            }\r\n            callback(null);\r\n        }, fnCallback);\r\n    }\r\n    //Check to see if we are deleting any skills\r\n    function deleteSkills(fnCallback) {\r\n        async.eachSeries(Object.keys(behaviours), function (aBehaviour, callback) {\r\n            //Delete Skill\r\n            if (aBehaviour.indexOf('deleteskillid') > -1) {\r\n                var skillToDelete = aBehaviour;\r\n                var skillID = String(skillToDelete.match(/[0-9]+/g));\r\n                connection.get().query('DELETE FROM skills WHERE skill_id = ?', [skillID], function (err, skillResults) {\r\n                    //If an error is thrown\r\n                    if (err) {\r\n                        returnObj['message'] = 'Our database servers maybe down. Please try again.';\r\n                        returnObj['savedBehaviours'] = behaviours;\r\n                        returnObj['skillTitle'] = req.body.skillid1;\r\n                        //Render the page wth error messages\r\n                        return res.render('behaviours/add-behaviour', returnObj);\r\n                    }\r\n                    else {\r\n                        behaviourDeleted = true;\r\n                        skillDeleted = true;\r\n                        fnCallback(null);\r\n                    }\r\n                });\r\n            }\r\n            else\r\n            {\r\n                callback(null);\r\n            }\r\n        }, fnCallback);\r\n    }\r\n    //Check to see if we are deleting any behaviours\r\n    function deleteBehaviours(fnCallback)\r\n    {\r\n        if (!skillDeleted) {\r\n            async.eachSeries(Object.keys(behaviours), function (aBehaviour, callback) {\r\n                //Delete Behaviour\r\n                if (aBehaviour.indexOf('deletebehaviourid') > -1) {\r\n                    var behaviourToDelete = aBehaviour;\r\n                    var behaviourID = String(behaviourToDelete.match(/[0-9]+/g));\r\n                    connection.get().query('DELETE behaviours FROM behaviours INNER JOIN skills ON skills.skill_id = behaviours.skill_id WHERE behaviours.behaviour_id = ?', [behaviourID], function (err, skillResults) {\r\n                        //If an error is thrown\r\n                        if (err) {\r\n                            returnObj['message'] = 'Our database servers maybe down. Please try again.';\r\n                            returnObj['savedBehaviours'] = behaviours;\r\n                            returnObj['skillTitle'] = req.body.skillid1;\r\n                            //Render the page wth error messages\r\n                            return res.render('behaviours/add-behaviour', returnObj);\r\n                        }\r\n                        else {\r\n                            behaviourDeleted = true;\r\n                            callback(null);\r\n                        }\r\n                    });\r\n                }\r\n                else\r\n                {\r\n                    callback(null);\r\n                }\r\n            }, fnCallback);\r\n        }\r\n        else\r\n        {\r\n            fnCallback(null);\r\n        }\r\n    }\r\n    //If we aren't deleting any skills or behaviours, we must be updating a skill\r\n    function updateSkill(fnCallback) {\r\n        if (!behaviourDeleted) {\r\n            async.eachSeries(Object.keys(behaviours), function (aBehaviour, callback) {\r\n                if (skillTitle != null || skillTitle != \"\") {\r\n                    //Update the skill name\r\n                    connection.get().query('UPDATE skills SET skill_title = ? WHERE skill_id = ?', [skillTitle, req.params.skill], function (err, skillResults) {\r\n                        //If an error is thrown\r\n                        if (err) {\r\n                            returnObj['message'] = 'Our database servers maybe down. Please try again.';\r\n                            returnObj['savedBehaviours'] = behaviours;\r\n                            returnObj['skillTitle'] = req.body.skillid1;\r\n                            //Render the page wth error messages\r\n                            return res.render('behaviours/add-behaviour', returnObj);\r\n                        }\r\n                        else {\r\n                            callback(null);\r\n                        }\r\n                    });\r\n                }\r\n                else {\r\n                    returnObj['message'] = 'One of the skills was empty, please enter a skill name';\r\n                    returnObj['savedBehaviours'] = behaviours;\r\n                    returnObj['skillTitle'] = req.body.skillid1;\r\n                    //Render the page wth error messages\r\n                    return res.render('behaviours/add-behaviour', returnObj);\r\n                }\r\n            }, fnCallback);\r\n        }\r\n        else\r\n        {\r\n            fnCallback(null);\r\n        }\r\n    }\r\n    //If we aren't deleting any skills or behaviours, we must be updating a behaviour\r\n    function updateBehaviour(fnCallback)\r\n    {\r\n        async.eachSeries(Object.keys(behaviours), function (aBehaviour, callback) {\r\n            if(!skillDeleted && !behaviourDeleted) {\r\n                //Update the behaviour description\r\n                if (aBehaviour.indexOf('behaviourid') > -1) {\r\n                    if (behaviours[aBehaviour] == null || behaviours[aBehaviour] == \"\") {\r\n                        returnObj['message'] = 'One of the behaviours was empty, please enter a behaviour description';\r\n                        returnObj['savedBehaviours'] = behaviours;\r\n                        returnObj['skillTitle'] = req.body.skillid1;\r\n                        //Render the page wth error messages\r\n                        return res.render('behaviours/add-behaviour', returnObj);\r\n                    }\r\n                    behaviourAdded = true;\r\n                    behaviourDesc = behaviours[aBehaviour];\r\n                    //Regex to extract numbers from textarea id\r\n                    num = String(aBehaviour.match(/[0-9]+/g));\r\n                    connection.get().query('SELECT behaviour_id FROM behaviours WHERE behaviour_id = ?', num, function (err, behaviourResults) {\r\n                        //If an error is thrown\r\n                        if (err) {\r\n                            returnObj['message'] = 'Our database servers maybe down. Please try again.';\r\n                            returnObj['savedBehaviours'] = behaviours;\r\n                            returnObj['skillTitle'] = req.body.skillid1;\r\n                            //Render the page wth error messages\r\n                            return res.render('behaviours/add-behaviour', returnObj);\r\n                        }\r\n                        //Add Behaviour\r\n                        else if (behaviourResults.length <= 0) {\r\n                            //Creating the JSON array to store the behaviour data\r\n                            var behaviour = {\r\n                                skill_id: req.params.skill,\r\n                                behaviour_desc: behaviourDesc\r\n                            }; //End behaviour\r\n                            connection.get().query('INSERT INTO behaviours SET ?', [behaviour], function (err, skillResults) {\r\n                                //If an error is thrown\r\n                                if (err) {\r\n                                    returnObj['message'] = 'Our database servers maybe down. Please try again.';\r\n                                    returnObj['savedBehaviours'] = behaviours;\r\n                                    returnObj['skillTitle'] = req.body.skillid1;\r\n                                    //Render the page wth error messages\r\n                                    return res.render('behaviours/add-behaviour', returnObj);\r\n                                }\r\n                                else {\r\n                                    callback(null);\r\n                                }\r\n                            });\r\n                        }\r\n                        else\r\n                        {\r\n                            //Update Behaviour\r\n                            connection.get().query('UPDATE behaviours SET behaviour_desc = ? WHERE behaviour_id = ?', [behaviourDesc, num], function (err, skillResults) {\r\n                                //If an error is thrown\r\n                                if (err) {\r\n                                    returnObj['message'] = 'Our database servers maybe down. Please try again.';\r\n                                    returnObj['savedBehaviours'] = behaviours;\r\n                                    returnObj['skillTitle'] = req.body.skillid1;\r\n                                    //Render the page wth error messages\r\n                                    return res.render('behaviours/add-behaviour', returnObj);\r\n                                }\r\n                                else {\r\n                                    callback(null);\r\n                                }\r\n                            });\r\n                        }\r\n                    });\r\n                }\r\n            }\r\n            else {\r\n                fnCallback(null);\r\n            }\r\n        }, fnCallback);\r\n    }\r\n    //Finally redirect the user back to the behaviours page\r\n    function redirectUser(fnCallback)\r\n    {\r\n        //If all is good, return them to the behaviours page\r\n        if (behaviourDeleted && !skillDeleted) {\r\n            req.flash('success_messages', 'The behaviour was successfully deleted from the database.');\r\n            req.session.success = true;\r\n            returnObj['message'] = undefined;\r\n            //callback(null);\r\n            return res.redirect('/users/behaviours');\r\n        }\r\n        else {\r\n            req.flash('success_messages', 'The skill ' + skillTitle + ' and behaviour(s) have been edited successfully.');\r\n            req.session.success = true;\r\n            returnObj['message'] = undefined;\r\n            return res.redirect('/users/behaviours');\r\n        }\r\n    }\r\n});\r\n// When the user has added a behaviour, update the database and return them to the behaviours page\r\nrouter.post('/add-behaviour', ensureAuthenticated, function (req, res, next) {\r\n    if (!req.body) { return res.sendStatus(400); }\r\n    //Set the save data to null first so its not passed if the form submission was successful\r\n    returnObj['savedBehaviours'] = undefined;\r\n    returnObj['skillTitle'] = undefined;\r\n    var behaviours = req.body;\r\n    var skillTitle = req.body.skillid1;\r\n    var skillID = '';\r\n    var behaviourDesc = '';\r\n    var num = \"\";\r\n    var skillsDone = false;\r\n    var behavioursDone = false;\r\n    returnObj['title'] ='Add Skills/Behaviours';\r\n    //Filter post data\r\n    async.eachSeries(Object.keys(behaviours), function (aSkill, callback) {\r\n        if (aSkill.indexOf('skillid') == -1 && aSkill.indexOf('behaviourid') == -1) {\r\n            delete behaviours[aSkill];\r\n        }\r\n    }\r\n    );\r\n    //If a behaviour is blank stop, and show them an error message\r\n    for(var aBehaviour in behaviours)\r\n    {\r\n        if (aBehaviour.indexOf('behaviourid') > -1) {\r\n            if (behaviours[aBehaviour] == null || behaviours[aBehaviour] == \"\") {\r\n                returnObj['message'] = 'One of the behaviours was empty, please enter a behaviour name';\r\n                //Render the page wth error messages\r\n                returnObj['savedBehaviours'] = behaviours;\r\n                returnObj['skillTitle'] = req.body.skillid1;\r\n                return res.render('behaviours/add-behaviour', returnObj);\r\n            }\r\n        }\r\n    }\r\n\r\n    async.series([\r\n        insertSkill,\r\n        insertBehaviours,\r\n        redirectUser\r\n    ], function(err, results) {\r\n        utility.log({ type: 'log', message: results });\r\n    });\r\n\r\n\r\n    function insertSkill(fnCallback){\r\n        //Get the skill title and behaviours, then perform CRUD if necessary\r\n        async.eachSeries(Object.keys(behaviours), function (aSkill, callback){\r\n            if (aSkill.indexOf('skillid') > -1) {\r\n                if (behaviours[aSkill] == null || behaviours[aSkill] == \"\") {\r\n                    returnObj['message'] = 'One of the skills was empty, please enter a skill name';\r\n                    returnObj['savedBehaviours'] = behaviours;\r\n                    returnObj['skillTitle'] = req.body.skillid1;\r\n                    //Render the page wth error messages\r\n                    return res.render('behaviours/add-behaviour', returnObj);\r\n                }\r\n\r\n                //Regex to extract numbers from textarea id\r\n                skillTitle = behaviours[aSkill];\r\n                num = String(skillTitle.match(/[0-9]+/g));\r\n                connection.get().query('SELECT skill_id FROM skills WHERE skill_id = ?', num, function (err, skillResults) {\r\n                    //If an error is thrown\r\n                    if (err) {\r\n                        returnObj['message'] = 'Our database servers maybe down. Please try again.';\r\n                        returnObj['savedBehaviours'] = behaviours;\r\n                        returnObj['skillTitle'] = req.body.skillid1;\r\n                        //Render the page wth error messages\r\n                        return res.render('behaviours/add-behaviour', returnObj);\r\n                    }\r\n                    //Add Behaviour\r\n                    if (skillTitle != null || skillTitle != \"\") {\r\n                        //Creating the JSON array to store the behaviour data\r\n                        var skill = {\r\n                            skill_title: skillTitle\r\n                        }; //End behaviour\r\n                        connection.get().query('INSERT INTO skills SET ?', [skill], function (err, skillResults) {\r\n                            //If an error is thrown\r\n                            if (err) {\r\n                                returnObj['message'] = 'Our database servers maybe down. Please try again.';\r\n                                returnObj['savedBehaviours'] = behaviours;\r\n                                returnObj['skillTitle'] = req.body.skillid1;\r\n                                //Render the page wth error messages\r\n                                return res.render('behaviours/add-behaviour', returnObj);\r\n                            }\r\n                            else {\r\n                                callback(null);\r\n                                skillID = skillResults.insertId;\r\n                                fnCallback(null);\r\n                            }\r\n                        });\r\n                    }\r\n                    else\r\n                    {\r\n                        returnObj['message'] = 'One of the skills was empty, please enter a skill name';\r\n                        returnObj['savedBehaviours'] = behaviours;\r\n                        returnObj['skillTitle'] = req.body.skillid1;\r\n                        //Render the page wth error messages\r\n                        return res.render('behaviours/add-behaviour', returnObj);\r\n                    }\r\n                });\r\n            }\r\n        },fnCallback);\r\n    }\r\n    function insertBehaviours(fnCallback){\r\n        async.eachSeries(Object.keys(behaviours), function (aBehaviour, secondCallback) {\r\n            if (aBehaviour.indexOf('behaviourid') > -1) {\r\n                if (behaviours[aBehaviour] == null || behaviours[aBehaviour] == \"\") {\r\n                    returnObj['message'] = 'One of the behaviours was empty, please enter a behaviour name';\r\n                    returnObj['savedBehaviours'] = behaviours;\r\n                    returnObj['skillTitle'] = req.body.skillid1;\r\n                    //Render the page wth error messages\r\n                    return res.render('behaviours/add-behaviour', returnObj);\r\n                }\r\n                behaviourDesc = behaviours[aBehaviour];\r\n                if (skillID != '') {\r\n                    var behaviour = {\r\n                        skill_id: skillID,\r\n                        behaviour_desc: behaviourDesc\r\n                    }; //End behaviour\r\n                    connection.get().query('INSERT INTO behaviours SET ?', [behaviour], function (err, skillResults) {\r\n                        //If an error is thrown\r\n                        if (err) {\r\n                            returnObj['message'] = 'Our database servers maybe down. Please try again.';\r\n                            returnObj['savedBehaviours'] = behaviours;\r\n                            returnObj['skillTitle'] = req.body.skillid1;\r\n                            //Render the page wth error messages\r\n                            return res.render('behaviours/add-behaviour', returnObj);\r\n                        }\r\n                    });\r\n                }\r\n            }\r\n            secondCallback(null);\r\n        },fnCallback);\r\n    }\r\n    function redirectUser(fnCallBack)\r\n    {\r\n        //Update the behaviour description\r\n        //If all is good, return them to the behaviours page\r\n        req.flash('success_messages', 'The behaviour was successfully added to the database.');\r\n        req.session.success = true;\r\n        returnObj['message'] = undefined;\r\n        return res.redirect('/users/behaviours');\r\n    }\r\n});\r\n\r\n// When the user has edited a behaviour, update the database and return them to the behaviours page\r\nrouter.post('/add-behaviour/:skill', ensureAuthenticated, function (req, res, next) {\r\n    if (!req.body) { return res.sendStatus(400); }\r\n    //Set the save data to null first so its not passed if the form submission was successful\r\n    returnObj['savedBehaviours'] = undefined;\r\n    returnObj['skillTitle'] = undefined;\r\n    //Store variables from the submitted form\r\n    var behaviours = req.body;\r\n    var skillTitle = req.body.skillTitleBox;\r\n    var behaviourDesc = '';\r\n    var num = '';\r\n    returnObj['title'] ='Edit Skills/Behaviours';\r\n    var behaviourAdded = false;\r\n    var behaviourDeleted = false;\r\n    var skillDeleted = false;\r\n    //Execute these functions in series, that is 1 after the other\r\n    async.series([\r\n        filterPostData,\r\n        deleteSkills,\r\n        deleteBehaviours,\r\n        updateSkill,\r\n        updateBehaviour,\r\n        redirectUser\r\n    ], function(err, results){\r\n    });\r\n    //Filter submitted data\r\n    function filterPostData(fnCallback) {\r\n        async.eachSeries(Object.keys(behaviours), function (aBehaviour, callback) {\r\n            if (aBehaviour.indexOf('skillid') == -1 && aBehaviour.indexOf('behaviourid') == -1 && aBehaviour.indexOf('deletebehaviourid') == -1 && aBehaviour.indexOf('deleteskillid') == -1) {\r\n                delete behaviours[aBehaviour];\r\n            }\r\n            callback(null);\r\n        }, fnCallback);\r\n    }\r\n    //Check to see if we are deleting any skills\r\n    function deleteSkills(fnCallback) {\r\n        async.eachSeries(Object.keys(behaviours), function (aBehaviour, callback) {\r\n            //Delete Skill\r\n            if (aBehaviour.indexOf('deleteskillid') > -1) {\r\n                var skillToDelete = aBehaviour;\r\n                var skillID = String(skillToDelete.match(/[0-9]+/g));\r\n                connection.get().query('DELETE FROM skills WHERE skill_id = ?', [skillID], function (err, skillResults) {\r\n                    //If an error is thrown\r\n                    if (err) {\r\n                        returnObj['message'] = 'Our database servers maybe down. Please try again.';\r\n                        returnObj['savedBehaviours'] = behaviours;\r\n                        returnObj['skillTitle'] = req.body.skillid1;\r\n                        //Render the page wth error messages\r\n                        return res.render('behaviours/add-behaviour', returnObj);\r\n                    }\r\n                    else {\r\n                        behaviourDeleted = true;\r\n                        skillDeleted = true;\r\n                        fnCallback(null);\r\n                    }\r\n                });\r\n            }\r\n            else\r\n            {\r\n                callback(null);\r\n            }\r\n        }, fnCallback);\r\n    }\r\n    //Check to see if we are deleting any behaviours\r\n    function deleteBehaviours(fnCallback)\r\n    {\r\n        if (!skillDeleted) {\r\n            async.eachSeries(Object.keys(behaviours), function (aBehaviour, callback) {\r\n                //Delete Behaviour\r\n                if (aBehaviour.indexOf('deletebehaviourid') > -1) {\r\n                    var behaviourToDelete = aBehaviour;\r\n                    var behaviourID = String(behaviourToDelete.match(/[0-9]+/g));\r\n                    connection.get().query('DELETE behaviours FROM behaviours INNER JOIN skills ON skills.skill_id = behaviours.skill_id WHERE behaviours.behaviour_id = ?', [behaviourID], function (err, skillResults) {\r\n                        //If an error is thrown\r\n                        if (err) {\r\n                            returnObj['message'] = 'Our database servers maybe down. Please try again.';\r\n                            returnObj['savedBehaviours'] = behaviours;\r\n                            returnObj['skillTitle'] = req.body.skillid1;\r\n                            //Render the page wth error messages\r\n                            return res.render('behaviours/add-behaviour', returnObj);\r\n                        }\r\n                        else {\r\n                            behaviourDeleted = true;\r\n                            callback(null);\r\n                        }\r\n                    });\r\n                }\r\n                else\r\n                {\r\n                    callback(null);\r\n                }\r\n            }, fnCallback);\r\n        }\r\n        else\r\n        {\r\n            fnCallback(null);\r\n        }\r\n    }\r\n    //If we aren't deleting any skills or behaviours, we must be updating a skill\r\n    function updateSkill(fnCallback) {\r\n        if (!behaviourDeleted) {\r\n            async.eachSeries(Object.keys(behaviours), function (aBehaviour, callback) {\r\n                if (skillTitle != null || skillTitle != \"\") {\r\n                    //Update the skill name\r\n                    connection.get().query('UPDATE skills SET skill_title = ? WHERE skill_id = ?', [skillTitle, req.params.skill], function (err, skillResults) {\r\n                        //If an error is thrown\r\n                        if (err) {\r\n                            returnObj['message'] = 'Our database servers maybe down. Please try again.';\r\n                            returnObj['savedBehaviours'] = behaviours;\r\n                            returnObj['skillTitle'] = req.body.skillid1;\r\n                            //Render the page wth error messages\r\n                            return res.render('behaviours/add-behaviour', returnObj);\r\n                        }\r\n                        else {\r\n                            callback(null);\r\n                        }\r\n                    });\r\n                }\r\n                else {\r\n                    returnObj['message'] = 'One of the skills was empty, please enter a skill name';\r\n                    returnObj['savedBehaviours'] = behaviours;\r\n                    returnObj['skillTitle'] = req.body.skillid1;\r\n                    //Render the page wth error messages\r\n                    return res.render('behaviours/add-behaviour', returnObj);\r\n                }\r\n            }, fnCallback);\r\n        } else {\r\n            fnCallback(null);\r\n        }\r\n    }\r\n    //If we aren't deleting any skills or behaviours, we must be updating a behaviour\r\n    function updateBehaviour(fnCallback) {\r\n        async.eachSeries(Object.keys(behaviours), function (aBehaviour, callback) {\r\n            if(!skillDeleted && !behaviourDeleted) {\r\n                //Update the behaviour description\r\n                if (aBehaviour.indexOf('behaviourid') > -1) {\r\n                    if (behaviours[aBehaviour] == null || behaviours[aBehaviour] == \"\") {\r\n                        returnObj['message'] = 'One of the behaviours was empty, please enter a behaviour description';\r\n                        returnObj['savedBehaviours'] = behaviours;\r\n                        returnObj['skillTitle'] = req.body.skillid1;\r\n                        //Render the page wth error messages\r\n                        return res.render('behaviours/add-behaviour', returnObj);\r\n                    }\r\n                    behaviourAdded = true;\r\n                    behaviourDesc = behaviours[aBehaviour];\r\n                    //Regex to extract numbers from textarea id\r\n                    num = String(aBehaviour.match(/[0-9]+/g));\r\n                    connection.get().query('SELECT behaviour_id FROM behaviours WHERE behaviour_id = ?', num, function (err, behaviourResults) {\r\n                        //If an error is thrown\r\n                        if (err) {\r\n                            returnObj['message'] = 'Our database servers maybe down. Please try again.';\r\n                            returnObj['savedBehaviours'] = behaviours;\r\n                            returnObj['skillTitle'] = req.body.skillid1;\r\n                            //Render the page wth error messages\r\n                            return res.render('behaviours/add-behaviour', returnObj);\r\n                        }\r\n                        //Add Behaviour\r\n                        else if (behaviourResults.length <= 0) {\r\n                            //Creating the JSON array to store the behaviour data\r\n                            var behaviour = {\r\n                                skill_id: req.params.skill,\r\n                                behaviour_desc: behaviourDesc\r\n                            }; //End behaviour\r\n                            connection.get().query('INSERT INTO behaviours SET ?', [behaviour], function (err, skillResults) {\r\n                                //If an error is thrown\r\n                                if (err) {\r\n                                    returnObj['message'] = 'Our database servers maybe down. Please try again.';\r\n                                    returnObj['savedBehaviours'] = behaviours;\r\n                                    returnObj['skillTitle'] = req.body.skillid1;\r\n                                    //Render the page wth error messages\r\n                                    return res.render('behaviours/add-behaviour', returnObj);\r\n                                }\r\n                                else {\r\n                                    callback(null);\r\n                                }\r\n                            });\r\n                        }\r\n                        else\r\n                        {\r\n                            //Update Behaviour\r\n                            connection.get().query('UPDATE behaviours SET behaviour_desc = ? WHERE behaviour_id = ?', [behaviourDesc, num], function (err, skillResults) {\r\n                                //If an error is thrown\r\n                                if (err) {\r\n                                    returnObj['message'] = 'Our database servers maybe down. Please try again.';\r\n                                    returnObj['savedBehaviours'] = behaviours;\r\n                                    returnObj['skillTitle'] = req.body.skillid1;\r\n                                    //Render the page wth error messages\r\n                                    return res.render('behaviours/add-behaviour', returnObj);\r\n                                }\r\n                                else {\r\n                                    callback(null);\r\n                                }\r\n                            });\r\n                        }\r\n                    });\r\n                }\r\n            }\r\n        },fnCallback);\r\n    }\r\n    //Finally redirect the user back to the behaviours page\r\n    function redirectUser(fnCallback)\r\n    {\r\n        //If all is good, return them to the behaviours page\r\n        if (behaviourDeleted && !skillDeleted) {\r\n            req.flash('success_messages', 'The behaviour was successfully deleted from the database.');\r\n            req.session.success = true;\r\n            returnObj['message'] = undefined;\r\n            //callback(null);\r\n            return res.redirect('/users/behaviours');\r\n        }\r\n        else {\r\n            req.flash('success_messages', 'The skill ' + skillTitle + ' and behaviour(s) have been edited successfully.');\r\n            req.session.success = true;\r\n            returnObj['message'] = undefined;\r\n            return res.redirect('/users/behaviours');\r\n        }\r\n    }\r\n});\r\n\r\n// Ensure sure the user is authenticated\r\nfunction ensureAuthenticated(req, res, next) {\r\n    if (req.isAuthenticated()) { return next(); }\r\n    res.redirect('/');\r\n}\r\n\r\nmodule.exports = router;"]}
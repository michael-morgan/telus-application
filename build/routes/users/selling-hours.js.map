{"version":3,"sources":["selling-hours.es6"],"names":[],"mappings":"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","file":"selling-hours.js","sourcesContent":["/**\n * Created by Jacob on 2016-05-29.\n */\nvar express = require('express');\nvar connection = require('../../connection');\nvar passport = require('passport');\n\nvar userModel = require('../../models/user');\nvar storeModel = require('../../models/store');\nvar sellingHoursModel = require('../../models/selling-hours');\nvar returnObj = {};\nvar router = express.Router();\n\n// Get for behaviours and show them for each skill\nrouter.get('/', ensureAuthenticated, function (req, res, next) {\n    returnObj['message'] = undefined;\n    let storeIds = [];\n    //Ensure user is logged in\n    if (req.user.privileged <= 2) { return res.redirect('/users/'); }\n\n    if (!req.body) { return res.sendStatus(400); }\n\n    returnObj['title'] = 'Selling Hours';\n    storeModel.getStoresByTNumber(req.user.t_number, (err, result) => {\n        if (err) {\n            throw next(err);\n        } //end if\n\n        returnObj['stores'] = result;\n        returnObj['storesObj'] = JSON.stringify(returnObj['stores']);\n        for(let storeIndex in returnObj['stores']) {\n            if(!returnObj['stores'].hasOwnProperty(storeIndex)) { continue; }\n            storeIds.push(returnObj['stores'][storeIndex].store_id);\n        }\n\n        userModel.getAllUsersByStoreIds(storeIds, (err, result) => {\n            if (err) {\n                throw next(err);\n            } //end if\n            returnObj['users'] = result;\n            returnObj['usersObj'] = JSON.stringify(result);\n            returnObj['selectedEmployee'] = req.user.t_number;\n            //Display success message on adding a transaction\n            sellingHoursModel.getHoursByStoreIDForCurrentWeek(req.session.store_id,(err, result) => {\n                if (err) {\n                    throw next(err);\n                } //end if)\n                returnObj['hours'] = result;\n                returnObj['hoursObj'] = JSON.stringify(result);\n                if (req.session.success) {\n                    req.flash('success_messages', 'Transaction successfully added!');\n                    //res.locals.success_messages = req.flash('success_messages');\n                    req.session.success = false;\n                }  //end if\n\n                return res.render('selling-hours/selling-hours', returnObj);\n            });\n        });\n    });\n});\n\nrouter.post('/', ensureAuthenticated, (req, res, next) => {\n    var data = req.body.name;\n    data = data.split(',');\n    //Update selling hours\n    sellingHoursModel.updateHoursByID([req.body.value,data[0],data[1],data[2]], (err, result) => {\n        if (err) {\n            return res.end('Error: ' + err.message);\n        }\n        //No rows affected, guess we have to insert\n        if(result == 0)\n        {\n            console.log(\"Selling Hours: \"+req.body.value);\n            console.log(\"team_member: \"+ data[0]);\n            console.log(\"store_id: \"+ data[1]);\n            console.log(\"date: \"+ data[2]);\n\n            var hours = {\n                selling_hours: req.body.value,\n                team_member: data[0],\n                store_id: data[1],\n                date: data[2]\n            };\n            sellingHoursModel.create(hours, (err, result) => {\n                if (err) {\n                    return res.end('Error: ' + err.message);\n                }\n                res.send(JSON.stringify(req.body));\n            });\n        }\n        else\n            res.send(JSON.stringify(req.body));\n    });\n});\n\n// Ensure sure the user is authenticated\nfunction ensureAuthenticated(req, res, next) {\n    if (req.isAuthenticated()) { return next(); }\n    res.redirect('/');\n}\n\nmodule.exports = router;"]}
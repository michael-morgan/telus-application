{"version":3,"sources":["connection.es6"],"names":[],"mappings":";;AAAA;;;;;;;AAOA,IAAI,QAAQ,QAAQ,OAAR,CAAZ;AAAA,IAA8B,QAAQ,QAAQ,OAAR,CAAtC;;AAEA,IAAI,QAAQ;AACR,UAAM;AADE,CAAZ;;AAIA,QAAQ,OAAR,GAAkB,UAAS,IAAT,EAAe;AAC7B,UAAM,IAAN,GAAa,MAAM,UAAN,CAAiB;AAC1B,cAAM,QAAQ,GAAR,CAAY,uBAAZ,IAAuC,WADnB;AAE1B,cAAM,QAAQ,GAAR,CAAY,uBAAZ,IAAuC,MAFnB;AAG1B,cAAM,QAAQ,GAAR,CAAY,2BAAZ,IAA2C,MAHvB;AAI1B,kBAAU,QAAQ,GAAR,CAAY,2BAAZ,IAA2C,UAJ3B;AAK1B,kBAAU,UALgB;AAM1B,4BAAoB;AANM,KAAjB,CAAb;AAQA;AACH,CAVD;;AAYA,QAAQ,GAAR,GAAc,YAAW;AACrB,WAAO,MAAM,IAAb;AACH,CAFD;;AAIA,QAAQ,QAAR,GAAmB,UAAS,IAAT,EAAe;AAC9B,QAAI,OAAO,MAAM,IAAjB;AACA,QAAI,CAAC,IAAL,EAAW;AACP,eAAO,KAAK,IAAI,KAAJ,CAAU,6BAAV,CAAL,CAAP;AACH;;AAED,QAAI,QAAQ,OAAO,IAAP,CAAY,KAAK,MAAjB,CAAZ;AACA,UAAM,IAAN,CAAW,KAAX,EAAkB,UAAS,IAAT,EAAe,EAAf,EAAmB;AACjC,cAAM,IAAN,CAAW,KAAK,MAAL,CAAY,IAAZ,CAAX,EAA8B,UAAS,GAAT,EAAc,EAAd,EAAkB;AAC5C,gBAAI,OAAO,OAAO,IAAP,CAAY,GAAZ,CAAX;AAAA,gBACI,SAAS,KAAK,GAAL,CAAS,UAAS,GAAT,EAAc;AAAE,uBAAO,MAAM,IAAI,GAAJ,CAAN,GAAiB,GAAxB;AAA6B,aAAtD,CADb;;AAGA,iBAAK,KAAL,CAAW,iBAAiB,IAAjB,GAAwB,IAAxB,GAA+B,KAAK,IAAL,CAAU,GAAV,CAA/B,GAAgD,YAAhD,GAA+D,OAAO,IAAP,CAAY,GAAZ,CAA/D,GAAkF,GAA7F,EAAkG,EAAlG;AACH,SALD,EAKG,EALH;AAMH,KAPD,EAOG,IAPH;AAQH,CAfD;;AAiBA,QAAQ,IAAR,GAAe,UAAS,MAAT,EAAiB,IAAjB,EAAuB;AAClC,QAAI,OAAO,MAAM,IAAjB;AACA,QAAI,CAAC,IAAL,EAAW;AACP,eAAO,KAAK,IAAI,KAAJ,CAAU,6BAAV,CAAL,CAAP;AACH;;AAED,UAAM,IAAN,CAAW,MAAX,EAAmB,UAAS,IAAT,EAAe,EAAf,EAAmB;AAClC,aAAK,KAAL,CAAW,mBAAmB,IAA9B,EAAoC,EAApC;AACH,KAFD,EAEG,IAFH;AAGH,CATD","file":"connection.js","sourcesContent":["/*\n Query result helpers:\n result.insertId -> auto incremented primary key from insert\n result.affectedRows -> number of affected rows from update/delete statement\n result.changedRows -> number of changed rows from update statement\n */\n\nvar mysql = require('mysql'), async = require('async');\n\nvar state = {\n    pool: null\n};\n\nexports.connect = function(done) {\n    state.pool = mysql.createPool({\n        host: process.env.OPENSHIFT_MYSQL_DB_HOST || 'localhost',\n        port: process.env.OPENSHIFT_MYSQL_DB_PORT || '3306',\n        user: process.env.OPENSHIFT_MYSQL_DB_USERNAME || 'root',\n        password: process.env.OPENSHIFT_MYSQL_DB_PASSWORD || 'password',\n        database: 'build_db',\n        multipleStatements: true\n    });\n    done();\n};\n\nexports.get = function() {\n    return state.pool;\n};\n\nexports.fixtures = function(data) {\n    var pool = state.pool;\n    if (!pool) {\n        return done(new Error('Missing database connection'));\n    }\n\n    var names = Object.keys(data.tables);\n    async.each(names, function(name, cb) {\n        async.each(data.tables[name], function(row, cb) {\n            var keys = Object.keys(row),\n                values = keys.map(function(key) { return \"'\" + row[key] + \"'\" });\n\n            pool.query('INSERT INTO ' + name + ' (' + keys.join(',') + ') VALUES (' + values.join(',') + ')', cb);\n        }, cb);\n    }, done);\n};\n\nexports.drop = function(tables, done) {\n    var pool = state.pool;\n    if (!pool) {\n        return done(new Error('Missing database connection'));\n    }\n\n    async.each(tables, function(name, cb) {\n        pool.query('DELETE * FROM ' + name, cb);\n    }, done);\n};\n\n\n"]}
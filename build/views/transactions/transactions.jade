extends ../layout

block append stylesheet
  link(rel='stylesheet', href='/bower_components/bootstrap-daterangepicker/daterangepicker.css')
  link(rel='stylesheet', href='/stylesheets/transactions.css')

block content
  .row
    .col-xs-12.col-md-10.col-md-offset-1
      h1.page-header #{title}
      if(message)
        .col-md-10.col-md-offset-1.col-xs-12
          div#successMessage.alert.success.alert-success(role='success')
            .alert-title
              i.fa.fa-check.fa-2x
              strong Great!
            p#successParagraph !{success_messages}
  .row.form-group
    .col-xs-12.col-sm-4.col-lg-2.col-lg-offset-1
      label(for='teamMember') Team Member:
      select.form-control(id='teamMember', name='teamMember')
        each user, userIndex in users
          option(value='#{user.t_number}') #{user.first_name} #{user.last_name}
    .col-xs-12.col-sm-4.col-lg-3.col-lg-offset-5
      label(for='dateRange') Date Range:
      .input-group
        span.input-group-addon#iconAddon
          i.fa.fa-calendar(aria-hidden='true')
        input.form-control(type='text', id='dateRange', name='dateRange', aria-describedby='iconAddon')
    .col-xs-12.col-lg-10.col-lg-offset-1
      hr
  .row
    .panel-group(role='tablist', aria-multiselectable='true')
      .col-xs-12.col-lg-10.col-lg-offset-1
        .panel.panel-default
          .panel-heading.purpleHead(role='tab', id='transactionHeading', data-toggle='collapse', data-target='#transactionCollapse')
            .row
              .col-xs-4.text-center
                h4.panel-title
                  | Acc. Units per Transaction:
                  strong(style='margin-left: 5px;') 1.33
              .col-xs-4.text-center
                h4.panel-title
                  | Basket Size:
                  strong(style='margin-left: 5px;') $38.33
              .col-xs-4.text-center
                h4.panel-title
                  | Average $ per HS:
                  strong(style='margin-left: 5px;') $147.50
          .panel-collapse.collapse(role='tabpanel', aria-labelledby='transactionHeading', id='transactionCollapse')
            .panel-body
              .panel.panel-default
                .panel-body
                  .col-xs-12.col-sm-6.col-md-4
                    strong Number of Transactions:
                    span(style='margin-left: 5px;') 4
                  .col-xs-12.col-sm-6.col-md-4
                    strong Device Care:
                    span(style='margin-left: 5px;') 66.7%
                  .col-xs-12.col-sm-6.col-md-4
                    strong iPhone:
                    span(style='margin-left: 5px;') 1
                  .col-xs-12.col-sm-6.col-md-4
                    strong Controllable Transactions:
                    span(style='margin-left: 5px;') 3
                  .col-xs-12.col-sm-6.col-md-4
                    strong AppleCare:
                    span(style='margin-left: 5px;') 100%
                  .col-xs-12.col-sm-6.col-md-4
                    strong Android:
                    span(style='margin-left: 5px;') 3
                  .col-xs-12.col-sm-6.col-md-4
                    strong Controllable Revenue:
                    span(style='margin-left: 5px;') $287.36
                  .col-xs-12.col-sm-6.col-md-4
                    strong Warranty:
                    span(style='margin-left: 5px;') 75%
                  .col-xs-12.col-sm-6.col-md-4
                    strong Other Devices:
                    span(style='margin-left: 5px;') 0
                  .col-xs-12
                    hr
                  .col-xs-12.col-sm-6.col-md-4
                    strong SBS Activations:
                    span(style='margin-left: 5px;') 0
                  .col-xs-12.col-sm-6.col-md-4
                    strong Learning Sessions:
                    span(style='margin-left: 5px;') 6
                  .col-xs-12.col-sm-6.col-md-4
                    strong Critters:
                    span(style='margin-left: 5px;') 0
                  .col-xs-12.col-sm-6.col-md-4
                    strong Appointments:
                    span(style='margin-left: 5px;') 1
                  .col-xs-12.col-sm-6.col-md-4
                    strong AOTM:
                    span(style='margin-left: 5px;') 2
                  .col-xs-12.col-sm-6.col-md-4
                    strong Donations:
                    span(style='margin-left: 5px;') 0
                  .col-xs-12.col-sm-6.col-md-4
                    strong Credit Cards:
                    span(style='margin-left: 5px;') 2
                  .col-xs-12.col-sm-6.col-md-4
                    strong Tablets:
                    span(style='margin-left: 5px;') 1
    .col-xs-12.col-lg-10.col-lg-offset-1
      hr

  .row
    .panel-group(role='tablist', aria-multiselectable='true')
      each store, storeIndex in stores
        .col-xs-12.col-lg-10.col-lg-offset-1
          .panel.panel-default
            .panel-heading.purpleHead(role='tab', id='storeHeading#{storeIndex}', data-toggle='collapse', data-target='#storeCollapse#{storeIndex}')
              .row
                .col-xs-12
                  h3.panel-title(style='font-size: 24px;')
                    | #{store.store_name}
            .panel-collapse.collapse(role='tabpanel', aria-labelledby='storeHeading#{storeIndex}', id='storeCollapse#{storeIndex}')
              .panel-body
                each transaction, transIndex in stores[storeIndex].transactions
                  .panel(id='transactionID#{transaction.transaction_id}')
                    .panel-heading.purpleHead
                      .row(role='tab', id='transactionHeading#{transIndex}', data-toggle='collapse', data-target='#transactionCollapse#{transIndex}')
                        .col-xs-4
                          h4.panel-title
                            | #{transaction.transaction_date.toLocaleDateString()}
                        .col-xs-4.text-center
                          h4.panel-title
                            | #{transaction.transactionItems.length} Item(s)
                        .col-xs-4
                          .pull-right
                            .col-xs-8(style='padding:0;')
                              h4.panel-title
                                | #{transaction.totalRevenue.toLocaleString('en-CA', { style: 'currency', currency: 'CAD' })}
                            .col-xs-4(style='padding:0;')
                              if user.privileged >= 3
                                .dropdown(style='margin-top:6px;')
                                  a.dropdown-toggle#ddMoreOptions(type='button', data-toggle='dropdown', aria-haspopup='true' aria-expanded='true')
                                    i.fa.fa-ellipsis-v.fa-2x(aria-hidden='true')
                                  ul.dropdown-menu(aria-labelledby='ddMoreOptions')
                                    li
                                      a(href='#' onclick='deleteTransaction(#{transaction.transaction_id})')
                                        | Remove Transaction
                    .panel-collapse.collapse(role='tabpanel', aria-labelledby='transactionHeading#{transIndex}', id='transactionCollapse#{transIndex}')
                      .panel-body
                        each transactionItem, transItemIndex in transaction.transactionItems
                          .col-xs-12.col-sm-6.col-md-4
                            strong Transaction Type:
                            span(style='margin-left: 5px;') #{transactionItem.transaction}
                          .col-xs-12.col-sm-6.col-md-4
                            strong Warranty Type:
                            span(style='margin-left: 5px;') #{transactionItem.warranty}
                          .col-xs-12.col-sm-6.col-md-4
                            strong Learning Sessions:
                            span(style='margin-left: 5px;')
                              each learning, learningIndex in transaction.additionalMetricItems
                                if learning.additional_metrics_items_type === 1
                                  | #{learning.additional_metrics_items_count}
                                else
                                  | 0
                          .col-xs-12.col-sm-6.col-md-4
                            strong Sale Type:
                            span(style='margin-left: 5px;') #{transactionItem.activation}
                          .col-xs-12.col-sm-6.col-md-4
                            strong Attach (Yes/No):
                            span(style='margin-left: 5px;') #{transactionItem.attachments === 1 ? 'Yes' : 'No'}
                          .col-xs-12.col-sm-6.col-md-4
                            strong AOTMs Sold:
                            span(style='margin-left: 5px;')
                              each learning, learningIndex in transaction.additionalMetricItems
                                if learning.additional_metrics_items_type === 2
                                  | #{learning.additional_metrics_items_count}
                                else
                                  | 0
                          .col-xs-12.col-sm-6.col-md-4
                            strong Device Type:
                            span(style='margin-left: 5px;') #{transactionItem.device}
                          .col-xs-12.col-sm-6.col-md-4
                            strong Revenue:
                            span(style='margin-left: 5px;') #{transactionItem.revenue.toLocaleString('en-CA', { style: 'currency', currency: 'CAD' })}
                          .col-xs-12.col-sm-6.col-md-4
                            strong Critters Sold:
                            span(style='margin-left: 5px;')
                              each learning, learningIndex in transaction.additionalMetricItems
                                if learning.additional_metrics_items_type === 4
                                  | #{learning.additional_metrics_items_count}
                                else
                                  | 0
                          .col-xs-12.col-sm-6.col-md-4
                            strong SBS Activation (Yes/No):
                            span(style='margin-left: 5px;') #{transactionItem.sbs_activation === 1 ? 'Yes' : 'No'}
                          .col-xs-12.col-sm-6.col-md-4
                            strong Number of Accessories:
                            span(style='margin-left: 5px;') #{transactionItem.number_of_accessories}
                          .col-xs-12.col-sm-6.col-md-4
                            strong Credit Card Apps:
                            span(style='margin-left: 5px;')
                              each learning, learningIndex in transaction.additionalMetricItems
                                if learning.additional_metrics_items_type === 6
                                  | #{learning.additional_metrics_items_count}
                                else
                                  | 0
                          .col-xs-12.col-sm-6.col-md-4
                            strong Appointments:
                            span(style='margin-left: 5px;')
                              each learning, learningIndex in transaction.additionalMetricItems
                                if learning.additional_metrics_items_type === 3
                                  | #{learning.additional_metrics_items_count}
                                else
                                  | 0
                          .col-xs-12.col-sm-6.col-md-4
                            strong Donations:
                            span(style='margin-left: 5px;')
                              each learning, learningIndex in transaction.additionalMetricItems
                                if learning.additional_metrics_items_type === 5
                                  | #{learning.additional_metrics_items_count}
                                else
                                  | 0
                          .col-xs-6(style='margin-top: 25px;')
                            .pull-left
                              strong Date:
                              span(style='margin-left: 5px;') #{transaction.transaction_date.toLocaleDateString()}
                          .col-xs-6(style='margin-top: 25px;')
                            .pull-right
                              strong Completed By:
                              span(style='margin-left: 5px;')
                                each user, userIndex in users
                                  if user.t_number === transaction.t_number
                                    | #{user.first_name} #{user.last_name}

block append script
  script(src='/bower_components/bootstrap-daterangepicker/moment.min.js')
  script(src='/bower_components/bootstrap-daterangepicker/daterangepicker.js')
  script(src='/javascripts/transactions/transactions.js')
  script.
    var storeObj = JSON.parse('!{storesObj}');